<br />
<b>Warning</b>:  Undefined array key "url" in <b>C:\xampp\htdocs\wordpress\wp-includes\cron.php</b> on line <b>949</b><br />
<br />
<b>Warning</b>:  Undefined array key "args" in <b>C:\xampp\htdocs\wordpress\wp-includes\cron.php</b> on line <b>949</b><br />
<!DOCTYPE html>
<html dir="ltr" lang="ja" prefix="og: https://ogp.me/ns#">
<head>
	<meta charset="UTF-8">
		<link rel="pingback" href="https://Drunkar.github.io/xmlrpc.php">
		<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>docker swarmのマルチホスト環境でnginxでダイナミックにリバースプロキシする | せかいらぼ</title>
	<style>img:is([sizes="auto" i], [sizes^="auto," i]) { contain-intrinsic-size: 3000px 1500px }</style>
	
		<!-- All in One SEO 4.5.9.1 - aioseo.com -->
		<meta name="description" content="software design 2014年12月号のDocker特集で、nginx + redisでダイナミックにリバースプロキシする方法が紹介されていました。 コンテナが追加されるたびに、定期実行しているプログラムでコンテナのローカルアドレスをredisに追加し、nginx-extras + lua moduleを使ってサブドメイン指定で対象コンテナにリバースプロキシするという感じ。コンテナを壊しては作るという変化の激しい状況にあって、いちいちリバースプロキシ先を追加することなく開発環境を管理できるというスグレモノです。" />
		<meta name="robots" content="max-image-preview:large" />
		<link rel="canonical" href="https://Drunkar.github.io/2015/05/31/docker-swarm-nginx-dynamix-reverse-proxy/" />
		<meta name="generator" content="All in One SEO (AIOSEO) 4.5.9.1" />
		<meta property="og:locale" content="ja_JP" />
		<meta property="og:site_name" content="せかいらぼ" />
		<meta property="og:type" content="article" />
		<meta property="og:title" content="docker swarmのマルチホスト環境でnginxでダイナミックにリバースプロキシする | せかいらぼ" />
		<meta property="og:description" content="software design 2014年12月号のDocker特集で、nginx + redisでダイナミックにリバースプロキシする方法が紹介されていました。 コンテナが追加されるたびに、定期実行しているプログラムでコンテナのローカルアドレスをredisに追加し、nginx-extras + lua moduleを使ってサブドメイン指定で対象コンテナにリバースプロキシするという感じ。コンテナを壊しては作るという変化の激しい状況にあって、いちいちリバースプロキシ先を追加することなく開発環境を管理できるというスグレモノです。" />
		<meta property="og:url" content="https://Drunkar.github.io/2015/05/31/docker-swarm-nginx-dynamix-reverse-proxy/" />
		<meta property="og:image" content="https://Drunkar.github.io/wp-content/uploads/2015/05/dynamic_proxy_multihost_s.png" />
		<meta property="og:image:secure_url" content="https://Drunkar.github.io/wp-content/uploads/2015/05/dynamic_proxy_multihost_s.png" />
		<meta property="og:image:width" content="507" />
		<meta property="og:image:height" content="268" />
		<meta property="article:published_time" content="2015-05-31T01:27:21+00:00" />
		<meta property="article:modified_time" content="2019-03-15T17:09:58+00:00" />
		<meta name="twitter:card" content="summary_large_image" />
		<meta name="twitter:site" content="@Drunkar" />
		<meta name="twitter:title" content="docker swarmのマルチホスト環境でnginxでダイナミックにリバースプロキシする | せかいらぼ" />
		<meta name="twitter:description" content="software design 2014年12月号のDocker特集で、nginx + redisでダイナミックにリバースプロキシする方法が紹介されていました。 コンテナが追加されるたびに、定期実行しているプログラムでコンテナのローカルアドレスをredisに追加し、nginx-extras + lua moduleを使ってサブドメイン指定で対象コンテナにリバースプロキシするという感じ。コンテナを壊しては作るという変化の激しい状況にあって、いちいちリバースプロキシ先を追加することなく開発環境を管理できるというスグレモノです。" />
		<meta name="twitter:creator" content="@Drunkar" />
		<meta name="twitter:image" content="https://Drunkar.github.io/wp-content/uploads/2015/05/dynamic_proxy_multihost_s.png" />
		<script type="application/ld+json" class="aioseo-schema">
			{"@context":"https:\/\/schema.org","@graph":[{"@type":"Article","@id":"https:\/\/Drunkar.github.io\/2015\/05\/31\/docker-swarm-nginx-dynamix-reverse-proxy\/#article","name":"docker swarm\u306e\u30de\u30eb\u30c1\u30db\u30b9\u30c8\u74b0\u5883\u3067nginx\u3067\u30c0\u30a4\u30ca\u30df\u30c3\u30af\u306b\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3059\u308b | \u305b\u304b\u3044\u3089\u307c","headline":"docker swarm\u306e\u30de\u30eb\u30c1\u30db\u30b9\u30c8\u74b0\u5883\u3067nginx\u3067\u30c0\u30a4\u30ca\u30df\u30c3\u30af\u306b\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3059\u308b","author":{"@id":"https:\/\/Drunkar.github.io\/author\/drunkar\/#author"},"publisher":{"@id":"https:\/\/Drunkar.github.io\/#organization"},"image":{"@type":"ImageObject","url":"https:\/\/Drunkar.github.io\/wp-content\/uploads\/2015\/05\/dynamic_proxy_multihost_s.png","width":507,"height":268},"datePublished":"2015-05-31T10:27:21+09:00","dateModified":"2019-03-16T02:09:58+09:00","inLanguage":"ja","mainEntityOfPage":{"@id":"https:\/\/Drunkar.github.io\/2015\/05\/31\/docker-swarm-nginx-dynamix-reverse-proxy\/#webpage"},"isPartOf":{"@id":"https:\/\/Drunkar.github.io\/2015\/05\/31\/docker-swarm-nginx-dynamix-reverse-proxy\/#webpage"},"articleSection":"articles, docker, python, top-posts"},{"@type":"BreadcrumbList","@id":"https:\/\/Drunkar.github.io\/2015\/05\/31\/docker-swarm-nginx-dynamix-reverse-proxy\/#breadcrumblist","itemListElement":[{"@type":"ListItem","@id":"https:\/\/Drunkar.github.io\/#listItem","position":1,"name":"\u5bb6","item":"https:\/\/Drunkar.github.io\/","nextItem":"https:\/\/Drunkar.github.io\/2015\/#listItem"},{"@type":"ListItem","@id":"https:\/\/Drunkar.github.io\/2015\/#listItem","position":2,"name":"2015","item":"https:\/\/Drunkar.github.io\/2015\/","nextItem":"https:\/\/Drunkar.github.io\/2015\/05\/#listItem","previousItem":"https:\/\/Drunkar.github.io\/#listItem"},{"@type":"ListItem","@id":"https:\/\/Drunkar.github.io\/2015\/05\/#listItem","position":3,"name":"May","item":"https:\/\/Drunkar.github.io\/2015\/05\/","nextItem":"https:\/\/Drunkar.github.io\/2015\/05\/31\/#listItem","previousItem":"https:\/\/Drunkar.github.io\/2015\/#listItem"},{"@type":"ListItem","@id":"https:\/\/Drunkar.github.io\/2015\/05\/31\/#listItem","position":4,"name":"31","item":"https:\/\/Drunkar.github.io\/2015\/05\/31\/","nextItem":"https:\/\/Drunkar.github.io\/2015\/05\/31\/docker-swarm-nginx-dynamix-reverse-proxy\/#listItem","previousItem":"https:\/\/Drunkar.github.io\/2015\/05\/#listItem"},{"@type":"ListItem","@id":"https:\/\/Drunkar.github.io\/2015\/05\/31\/docker-swarm-nginx-dynamix-reverse-proxy\/#listItem","position":5,"name":"docker swarm\u306e\u30de\u30eb\u30c1\u30db\u30b9\u30c8\u74b0\u5883\u3067nginx\u3067\u30c0\u30a4\u30ca\u30df\u30c3\u30af\u306b\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3059\u308b","previousItem":"https:\/\/Drunkar.github.io\/2015\/05\/31\/#listItem"}]},{"@type":"Organization","@id":"https:\/\/Drunkar.github.io\/#organization","name":"\u305b\u304b\u3044\u3089\u307c","url":"https:\/\/Drunkar.github.io\/","logo":{"@type":"ImageObject","url":"https:\/\/Drunkar.github.io\/wp-content\/uploads\/2018\/01\/cropped-title_wc_retina-1024x407-03.png","@id":"https:\/\/Drunkar.github.io\/2015\/05\/31\/docker-swarm-nginx-dynamix-reverse-proxy\/#organizationLogo","width":4301,"height":1101},"image":{"@id":"https:\/\/Drunkar.github.io\/2015\/05\/31\/docker-swarm-nginx-dynamix-reverse-proxy\/#organizationLogo"},"sameAs":["https:\/\/twitter.com\/Drunkar"]},{"@type":"Person","@id":"https:\/\/Drunkar.github.io\/author\/drunkar\/#author","url":"https:\/\/Drunkar.github.io\/author\/drunkar\/","name":"Drunkar","image":{"@type":"ImageObject","@id":"https:\/\/Drunkar.github.io\/2015\/05\/31\/docker-swarm-nginx-dynamix-reverse-proxy\/#authorImage","url":"https:\/\/secure.gravatar.com\/avatar\/9ca34479617ccb8284b89b84fb199041?s=96&d=mm&r=g","width":96,"height":96,"caption":"Drunkar"}},{"@type":"WebPage","@id":"https:\/\/Drunkar.github.io\/2015\/05\/31\/docker-swarm-nginx-dynamix-reverse-proxy\/#webpage","url":"https:\/\/Drunkar.github.io\/2015\/05\/31\/docker-swarm-nginx-dynamix-reverse-proxy\/","name":"docker swarm\u306e\u30de\u30eb\u30c1\u30db\u30b9\u30c8\u74b0\u5883\u3067nginx\u3067\u30c0\u30a4\u30ca\u30df\u30c3\u30af\u306b\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3059\u308b | \u305b\u304b\u3044\u3089\u307c","description":"software design 2014\u5e7412\u6708\u53f7\u306eDocker\u7279\u96c6\u3067\u3001nginx + redis\u3067\u30c0\u30a4\u30ca\u30df\u30c3\u30af\u306b\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3059\u308b\u65b9\u6cd5\u304c\u7d39\u4ecb\u3055\u308c\u3066\u3044\u307e\u3057\u305f\u3002 \u30b3\u30f3\u30c6\u30ca\u304c\u8ffd\u52a0\u3055\u308c\u308b\u305f\u3073\u306b\u3001\u5b9a\u671f\u5b9f\u884c\u3057\u3066\u3044\u308b\u30d7\u30ed\u30b0\u30e9\u30e0\u3067\u30b3\u30f3\u30c6\u30ca\u306e\u30ed\u30fc\u30ab\u30eb\u30a2\u30c9\u30ec\u30b9\u3092redis\u306b\u8ffd\u52a0\u3057\u3001nginx-extras + lua module\u3092\u4f7f\u3063\u3066\u30b5\u30d6\u30c9\u30e1\u30a4\u30f3\u6307\u5b9a\u3067\u5bfe\u8c61\u30b3\u30f3\u30c6\u30ca\u306b\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u3059\u308b\u3068\u3044\u3046\u611f\u3058\u3002\u30b3\u30f3\u30c6\u30ca\u3092\u58ca\u3057\u3066\u306f\u4f5c\u308b\u3068\u3044\u3046\u5909\u5316\u306e\u6fc0\u3057\u3044\u72b6\u6cc1\u306b\u3042\u3063\u3066\u3001\u3044\u3061\u3044\u3061\u30ea\u30d0\u30fc\u30b9\u30d7\u30ed\u30ad\u30b7\u5148\u3092\u8ffd\u52a0\u3059\u308b\u3053\u3068\u306a\u304f\u958b\u767a\u74b0\u5883\u3092\u7ba1\u7406\u3067\u304d\u308b\u3068\u3044\u3046\u30b9\u30b0\u30ec\u30e2\u30ce\u3067\u3059\u3002","inLanguage":"ja","isPartOf":{"@id":"https:\/\/Drunkar.github.io\/#website"},"breadcrumb":{"@id":"https:\/\/Drunkar.github.io\/2015\/05\/31\/docker-swarm-nginx-dynamix-reverse-proxy\/#breadcrumblist"},"author":{"@id":"https:\/\/Drunkar.github.io\/author\/drunkar\/#author"},"creator":{"@id":"https:\/\/Drunkar.github.io\/author\/drunkar\/#author"},"image":{"@type":"ImageObject","url":"https:\/\/Drunkar.github.io\/wp-content\/uploads\/2015\/05\/dynamic_proxy_multihost_s.png","@id":"https:\/\/Drunkar.github.io\/2015\/05\/31\/docker-swarm-nginx-dynamix-reverse-proxy\/#mainImage","width":507,"height":268},"primaryImageOfPage":{"@id":"https:\/\/Drunkar.github.io\/2015\/05\/31\/docker-swarm-nginx-dynamix-reverse-proxy\/#mainImage"},"datePublished":"2015-05-31T10:27:21+09:00","dateModified":"2019-03-16T02:09:58+09:00"},{"@type":"WebSite","@id":"https:\/\/Drunkar.github.io\/#website","url":"https:\/\/Drunkar.github.io\/","name":"\u305b\u304b\u3044\u3089\u307c","inLanguage":"ja","publisher":{"@id":"https:\/\/Drunkar.github.io\/#organization"}}]}
		</script>
		<!-- All in One SEO -->

<link rel="alternate" type="application/rss+xml" title="せかいらぼ &raquo; フィード" href="https://Drunkar.github.io/feed/" />
<link rel="alternate" type="application/rss+xml" title="せかいらぼ &raquo; コメントフィード" href="https://Drunkar.github.io/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="せかいらぼ &raquo; docker swarmのマルチホスト環境でnginxでダイナミックにリバースプロキシする のコメントのフィード" href="https://Drunkar.github.io/2015/05/31/docker-swarm-nginx-dynamix-reverse-proxy/feed/" />
		<!-- This site uses the Google Analytics by MonsterInsights plugin v8.25.0 - Using Analytics tracking - https://www.monsterinsights.com/ -->
		<!-- Note: MonsterInsights is not currently configured on this site. The site owner needs to authenticate with Google Analytics in the MonsterInsights settings panel. -->
					<!-- No tracking code set -->
				<!-- / Google Analytics by MonsterInsights -->
		<link rel='stylesheet' id='mci-footnotes-jquery-tooltips-pagelayout-none-css' href='https://Drunkar.github.io/wp-content/plugins/footnotes/css/footnotes-jqttbrpl0.min.css?ver=2.7.3' type='text/css' media='all' />
<link rel='stylesheet' id='wp-block-library-css' href='https://Drunkar.github.io/wp-includes/css/dist/block-library/style.min.css?ver=6.7.1' type='text/css' media='all' />
<style id='classic-theme-styles-inline-css' type='text/css'>
/*! This file is auto-generated */
.wp-block-button__link{color:#fff;background-color:#32373c;border-radius:9999px;box-shadow:none;text-decoration:none;padding:calc(.667em + 2px) calc(1.333em + 2px);font-size:1.125em}.wp-block-file__button{background:#32373c;color:#fff;text-decoration:none}
</style>
<style id='global-styles-inline-css' type='text/css'>
:root{--wp--preset--aspect-ratio--square: 1;--wp--preset--aspect-ratio--4-3: 4/3;--wp--preset--aspect-ratio--3-4: 3/4;--wp--preset--aspect-ratio--3-2: 3/2;--wp--preset--aspect-ratio--2-3: 2/3;--wp--preset--aspect-ratio--16-9: 16/9;--wp--preset--aspect-ratio--9-16: 9/16;--wp--preset--color--black: #000000;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #ffffff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgba(6,147,227,1) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgba(255,105,0,1) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--font-size--small: 13px;--wp--preset--font-size--medium: 20px;--wp--preset--font-size--large: 36px;--wp--preset--font-size--x-large: 42px;--wp--preset--spacing--20: 0.44rem;--wp--preset--spacing--30: 0.67rem;--wp--preset--spacing--40: 1rem;--wp--preset--spacing--50: 1.5rem;--wp--preset--spacing--60: 2.25rem;--wp--preset--spacing--70: 3.38rem;--wp--preset--spacing--80: 5.06rem;--wp--preset--shadow--natural: 6px 6px 9px rgba(0, 0, 0, 0.2);--wp--preset--shadow--deep: 12px 12px 50px rgba(0, 0, 0, 0.4);--wp--preset--shadow--sharp: 6px 6px 0px rgba(0, 0, 0, 0.2);--wp--preset--shadow--outlined: 6px 6px 0px -3px rgba(255, 255, 255, 1), 6px 6px rgba(0, 0, 0, 1);--wp--preset--shadow--crisp: 6px 6px 0px rgba(0, 0, 0, 1);}:where(.is-layout-flex){gap: 0.5em;}:where(.is-layout-grid){gap: 0.5em;}body .is-layout-flex{display: flex;}.is-layout-flex{flex-wrap: wrap;align-items: center;}.is-layout-flex > :is(*, div){margin: 0;}body .is-layout-grid{display: grid;}.is-layout-grid > :is(*, div){margin: 0;}:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-x-large-font-size{font-size: var(--wp--preset--font-size--x-large) !important;}
:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}
:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}
:root :where(.wp-block-pullquote){font-size: 1.5em;line-height: 1.6;}
</style>
<link rel='stylesheet' id='pz-linkcard-css' href='//Drunkar.github.io/wp-content/uploads/pz-linkcard/style.css?ver=2.5.3.30' type='text/css' media='all' />
<link rel='stylesheet' id='wordpress-popular-posts-css-css' href='https://Drunkar.github.io/wp-content/plugins/wordpress-popular-posts/assets/css/wpp.css?ver=6.4.2' type='text/css' media='all' />
<link rel='stylesheet' id='tokimeki-css' href='https://Drunkar.github.io/wp-content/themes/tokimeki/asset/css/style.min.css' type='text/css' media='all' />
<style id='tokimeki-inline-css' type='text/css'>
.site-header__inner, .primary-menu > .menu-item > a {
		background: #00b3c6;
	}
a, .button.hollow, .breadcrumbs a, .color-reverse:hover, .posts__item h2 a:hover, .widget-recent-post li:hover .widget-recent-post__meta {
		color: #00b3c6;
	}
	.button, .button.primary, .button.hollow.primary, .badge, .button-group.primary .button, .label, input[type="submit"], .main-content__pagination a, .main-content__pagination > span, .page-numbers {
		background: #00b3c6;
	}
	.button.hollow, .button.hollow.primary {
		border: 1px solid #00b3c6;
	}
	.primary-menu > .menu-item:hover::after {
		border-bottom-color: #00b3c6;
	}
	.site-footer {
		border-bottom: 6px #00b3c6 solid;
	}
</style>
<script type="text/javascript" src="https://Drunkar.github.io/wp-includes/js/jquery/jquery.min.js?ver=3.7.1" id="jquery-core-js"></script>
<script type="text/javascript" src="https://Drunkar.github.io/wp-includes/js/jquery/jquery-migrate.min.js?ver=3.4.1" id="jquery-migrate-js"></script>
<script type="text/javascript" src="https://Drunkar.github.io/wp-content/plugins/footnotes/js/jquery.tools.min.js?ver=1.2.7.redacted.2" id="mci-footnotes-jquery-tools-js"></script>
<script type="application/json" id="wpp-json">

{"sampling_active":0,"sampling_rate":100,"ajax_url":"https:\/\/Drunkar.github.io\/wp-json\/wordpress-popular-posts\/v1\/popular-posts","api_url":"https:\/\/Drunkar.github.io\/wp-json\/wordpress-popular-posts","ID":1470,"token":"9c19c691d1","lang":0,"debug":0}

</script>
<script type="text/javascript" src="https://Drunkar.github.io/wp-content/plugins/wordpress-popular-posts/assets/js/wpp.min.js?ver=6.4.2" id="wpp-js-js"></script>
<link rel="https://api.w.org/" href="https://Drunkar.github.io/wp-json/" /><link rel="alternate" title="JSON" type="application/json" href="https://Drunkar.github.io/wp-json/wp/v2/posts/1470" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://Drunkar.github.io/xmlrpc.php?rsd" />
<meta name="generator" content="WordPress 6.7.1" />
<link rel='shortlink' href='https://Drunkar.github.io/?p=1470' />
<link rel="alternate" title="oEmbed (JSON)" type="application/json+oembed" href="https://Drunkar.github.io/wp-json/oembed/1.0/embed?url=https%3A%2F%2Flocalhost%2Fwordpress%2F2015%2F05%2F31%2Fdocker-swarm-nginx-dynamix-reverse-proxy%2F" />
<link rel="alternate" title="oEmbed (XML)" type="text/xml+oembed" href="https://Drunkar.github.io/wp-json/oembed/1.0/embed?url=https%3A%2F%2Flocalhost%2Fwordpress%2F2015%2F05%2F31%2Fdocker-swarm-nginx-dynamix-reverse-proxy%2F&#038;format=xml" />
<script type="text/javascript">
(function(url){
	if(/(?:Chrome\/26\.0\.1410\.63 Safari\/537\.31|WordfenceTestMonBot)/.test(navigator.userAgent)){ return; }
	var addEvent = function(evt, handler) {
		if (window.addEventListener) {
			document.addEventListener(evt, handler, false);
		} else if (window.attachEvent) {
			document.attachEvent('on' + evt, handler);
		}
	};
	var removeEvent = function(evt, handler) {
		if (window.removeEventListener) {
			document.removeEventListener(evt, handler, false);
		} else if (window.detachEvent) {
			document.detachEvent('on' + evt, handler);
		}
	};
	var evts = 'contextmenu dblclick drag dragend dragenter dragleave dragover dragstart drop keydown keypress keyup mousedown mousemove mouseout mouseover mouseup mousewheel scroll'.split(' ');
	var logHuman = function() {
		if (window.wfLogHumanRan) { return; }
		window.wfLogHumanRan = true;
		var wfscr = document.createElement('script');
		wfscr.type = 'text/javascript';
		wfscr.async = true;
		wfscr.src = url + '&r=' + Math.random();
		(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(wfscr);
		for (var i = 0; i < evts.length; i++) {
			removeEvent(evts[i], logHuman);
		}
	};
	for (var i = 0; i < evts.length; i++) {
		addEvent(evts[i], logHuman);
	}
})('//Drunkar.github.io/?wordfence_lh=1&hid=28D36E4A90C2B98E1B35B4AE98B1D720');
</script><script type="text/javascript" src="//Drunkar.github.io/?wordfence_syncAttackData=1738930711.8999" async></script>            <style id="wpp-loading-animation-styles">@-webkit-keyframes bgslide{from{background-position-x:0}to{background-position-x:-200%}}@keyframes bgslide{from{background-position-x:0}to{background-position-x:-200%}}.wpp-widget-placeholder,.wpp-widget-block-placeholder,.wpp-shortcode-placeholder{margin:0 auto;width:60px;height:3px;background:#dd3737;background:linear-gradient(90deg,#dd3737 0%,#571313 10%,#dd3737 100%);background-size:200% auto;border-radius:3px;-webkit-animation:bgslide 1s infinite linear;animation:bgslide 1s infinite linear}</style>
            <link rel="icon" href="https://Drunkar.github.io/wp-content/uploads/2018/01/cropped-fabicon_large-32x32.png" sizes="32x32" />
<link rel="icon" href="https://Drunkar.github.io/wp-content/uploads/2018/01/cropped-fabicon_large-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon" href="https://Drunkar.github.io/wp-content/uploads/2018/01/cropped-fabicon_large-180x180.png" />
<meta name="msapplication-TileImage" content="https://Drunkar.github.io/wp-content/uploads/2018/01/cropped-fabicon_large-270x270.png" />
		<style type="text/css" id="wp-custom-css">
			body {
	font-family: 'Noto Sans Japanese', SourceHanSansJP-Light, YuGothic, 'Yu Gothic', "游ゴシック体", "游ゴシック", "ヒラギノ角ゴ Pro W3", "Hiragino Kaku Gothic Pro", "メイリオ", Meiryo, "ＭＳ Ｐゴシック", Osaka, "MS PGothic", Arial, Helvetica, Verdana, sans-serif;
}

.site-main-article {
  display: -ms-flexbox;
  display: flex;
  -ms-flex-pack: center;
  justify-content: center;
  padding: 1em 1.2em 5em 1.2em;
}

.post__content p, .post__content dl, .post__content ol, .post__content ul,
.post__content pre{
	padding: 0em 2em;
}

.post__content table {
	margin: 0em 2em;
}

h2 {
    color: #666;
    font-weight: bold;
}

.post__content h2, .post__content h3, .post__content h4 {
	font-weight: bold;
	color: #444;
}

.post__content h2 {
    font-size: 2.2rem;
    margin-top: 2em;
    position: relative;
    display: inline-block;
    padding: 0 2em 0 0.5em !important;
    vertical-align: middle;
    background: #00b3c6;
    color: #ffffff;
    border-radius: 5px 50px 0 0;
    font-weight: bolder;
    width: inherit;
    box-shadow: 2px 4px 0 #ccc;
}

.site-header__inner, .primary-menu > .menu-item > a {
    color: #efefef;
}

.site-header__logo {
    margin: 0;
}
.site-header__logo {
    max-height: 70px;
}
.site-main {
    padding: 1em 1.2em 5em 1.2em;
}
.site-header__inner {
    box-shadow: none;
}

.top-post__description h2 {
    text-shadow: 2px 2px #444;
	color: #fefefe;
}
.top-post__description-cat {
	text-shadow: 1.5px 1.5px #444;
}

.top-post {
  margin-bottom: 2em;
	box-shadow: 5px 10px #009eaf;
}

.posts__item .posts__item-thumb {
    height: calc(500px / 2);
}

.posts__item .posts__item-title {
    color: #444;
    font-weight: bold;
}

.posts__item {
	border-left: 1px solid #444;
	border-bottom: 1px solid #444;
  box-shadow: 4px 4px #009eaf;  
	background: #fefefe;
	border-radius: 50px 10px 10px 10px;
}

p {
    font-family: 'Noto Sans Japanese', SourceHanSansJP-Light, YuGothic, 'Yu Gothic', "游ゴシック体", "游ゴシック", "ヒラギノ角ゴ Pro W3", "Hiragino Kaku Gothic Pro", "メイリオ", Meiryo, "ＭＳ Ｐゴシック", Osaka, "MS PGothic", Arial, Helvetica, Verdana, sans-serif;
    -ms-text-size-adjust: 100%;
    -webkit-text-size-adjust: 100%;
    color: #444;
    overflow: hidden;
    font-size: 17px;
    line-height: 1.6;
    word-wrap: break-word;
    max-width: 700px;
}

.sidebar h2 {
    color: #666;
    font-weight: bold;
}

.wpp-list li {
    margin: 0 0 1px 0;
}

.sns-icon {
  font-size: 3em;
	margin-right: .2em;
}

#searchBtnIcon {
	color: #efefef;
	font-size: 3em;
}

.site-footer {
    background: #00b3c6;
}

.site-footer .copyright {
    color: #efefef;
}

@media screen and (max-width: 1439px) {
	.posts__item .posts__item-thumb {
			height: calc((100vw - 340px - 2.4rem) * .48 / 2);
	}
}

@media screen and (max-width: 1023px) {
	.site-main-article {
    -ms-flex-direction: column;
    flex-direction: column;
    padding-top: 2em;
  }

	.posts__item .posts__item-thumb {
    height: calc((100vw - 2.4rem) * .48 / 2);
	}
	.site-header__logo img {
			padding: 0;
	}

	.site-header__logo {
			max-height: 50px;
	}
	.site-main {
    padding: 0em 0.2em 1em 0.2em;
  }
	
	.post__content p, .post__content>dl, .post__content>ol, .post__content>ul{
		font-size: 14px;
	}
	.post__content h1, .post__content h2, .post__content h3, .post__content h4, .post__content h5, .post__content h6, .post__content p, .post__content>dl, .post__content>ol, .post__content>ul {
        margin-bottom: 1rem;
    }
	  .post__meta-top {
        margin-bottom: 0.1rem;
        font-size: 9px;
    }
	
	.posts {
    padding: 0.5em 2em 0 2em;
    background: #efefef;
	}
}

@media screen and (max-width: 767px) {
	.top-post__item {
		height: 150px;
    width: 100%;
    margin-bottom: 0.1em;
    border-style: solid;
    border-width: 2px;
	}
	.posts__item .posts__item-thumb {
    height: calc((100vw - 2.4rem)/ 2);
	}
	
	.posts__item .posts__item-title {
    margin-top: .4em;
	}
	.posts__item .posts__item-description {
    font-size: 9px;
  }
	.posts__item .posts__item-meta {
    font-size: 9px;
		padding: .2rem .8rem;
  }
	
	.posts__item {
    margin-bottom: 0.8rem;
    box-shadow: 2px 2px #009eaf;
}
	
	.post__content p, .post__content>dl, .post__content>ol, .post__content>ul,
	.post__content>pre{
		padding: 0em;
		font-size: 17px;
	}
	
	.post__header .post__meta {
    margin: 0;
  }
	
	#toc-sidebar {
		display: none;
	}

}

/* TOC */
#toc_container {
		margin: 2em 2.5em 1em -0.5em;
	  background: none !important;
	  border: none !important;
	  min-width: 400px;
}
#toc_container .toc_title {
		text-align: center;
    margin: 0;
    position: relative;
    display: inline-block;
    padding: 0 2em 0 0.5em !important;
	  font-size: 2em;
    vertical-align: middle;
    background: #00b3c6;
    color: #ffffff;
    border-radius: 5px 50px 0 0;
    font-weight: bolder;
}
#toc_container .toc_title:before {
    font-family: 'FontAwesome';
    content: '\f02d';
    margin-right: 0.3em;
}
#toc_container .toc_list {
		top: -3px;
    position: relative;
    padding: 1em;
    border: solid 3px #00b3c6;
    border-radius: 0px 20px 50px 20px;
    box-shadow: 2px 2px 0 #00b3c6;
}
#toc_container p.toc_title+ul.toc_list {
	  margin-top: 0 !important;
}

/* border block */
.post__content .box {
    margin: 2em 2.5em 1em 1.5em;
}
.post__content .box .box-title {
	  position: relative;
    display: inline-block;
    padding: 0 2em 0 0.5em;
    height: 25px;
    line-height: 25px;
    vertical-align: middle;
    font-size: 17px;
    background: #00b3c6;
    color: #ffffff;
    border-radius: 5px 50px 0 0;
	  font-weight: bolder;
}
.post__content .box .box-title:before {
    font-family: 'FontAwesome';
    content: '\f0a4';
    margin-right: 0.3em;
}
.post__content .box .box-content {
    top: -3px;
    position: relative;
    padding: 1em;
    border: solid 3px #00b3c6;
    border-radius: 0px 20px 50px 20px;
	  box-shadow: 2px 2px 0 #00b3c6;
}		</style>
		
<style type="text/css" media="all">
.footnotes_reference_container {margin-top: 24px !important; margin-bottom: 0px !important;}
.footnote_container_prepare > p {border-bottom: 1px solid #aaaaaa !important;}
.footnote_tooltip { font-size: 13px !important; background-color: #cee9ea !important; border-width: 1px !important; border-style: solid !important; border-color: #999999 !important; border-radius: 3px !important; -webkit-box-shadow: 2px 2px 11px #dddddd; -moz-box-shadow: 2px 2px 11px #dddddd; box-shadow: 2px 2px 11px #dddddd;}
.footnote_plugin_tooltip_text {
  top: 0.5em !important;
  color: #00b3c6;
  text-decoration: underline;
}

.footnote_plugin_link {
  color: #00b3c6;
  text-decoration: underline;
}

.footnote_tooltip {
  max-width: 600px;
}

#footnote_references_container {
  width: 90%;
  max-width: 650px;
}

.post__content table {
    font-size: 0.9em;
}

#footnote_references_container tbody {
  background-color: transparent;
  border: none;
}
#footnote_references_container tbody tr:nth-child(even) {
    background-color: transparent;
}

</style>
        <link rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script data-ad-client="ca-pub-7499184562108487" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
</head>

<body class="post-template-default single single-post postid-1470 single-format-standard wp-custom-logo no-ja" itemscope itemtype="http://schema.org/Blog">
	<a class="skip-link screen-reader-text" href="#main">コンテンツへスキップ</a>
	<header class="site-header" id="header">
	<div class="site-header__inner" itemscope itemtype="http://schema.org/WPHeader">
		<div class="site-header__col-left">
			<p class="site-header__logo" itemscope itemtype="http://schema.org/Organization" itemprop="publisher" id="data-site" role="banner">
		<a href="https://Drunkar.github.io/" class="custom-logo-link" rel="home"><img width="4301" height="1101" src="https://Drunkar.github.io/wp-content/uploads/2018/01/cropped-title_wc_retina-1024x407-03.png" class="custom-logo" alt="せかいらぼ" decoding="async" fetchpriority="high" srcset="https://Drunkar.github.io/wp-content/uploads/2018/01/cropped-title_wc_retina-1024x407-03.png 4301w, https://Drunkar.github.io/wp-content/uploads/2018/01/cropped-title_wc_retina-1024x407-03-300x77.png 300w, https://Drunkar.github.io/wp-content/uploads/2018/01/cropped-title_wc_retina-1024x407-03-768x197.png 768w, https://Drunkar.github.io/wp-content/uploads/2018/01/cropped-title_wc_retina-1024x407-03-1024x262.png 1024w" sizes="(max-width: 4301px) 100vw, 4301px" /></a>	<meta itemprop="name" content="せかいらぼ">
		<meta itemprop="description" content="">
</p>						<nav class="site-header__menu" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
				<ul id="menu-menu" class="primary-menu"><li id="menu-item-2027" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-2027"><a href="https://Drunkar.github.io/category/articles/">articles</a></li>
<li id="menu-item-2028" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-2028"><a href="https://Drunkar.github.io/category/stories/">stories</a></li>
<li id="menu-item-1822" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1822"><a href="https://Drunkar.github.io/about/">about</a></li>
</ul>			</nav>
						<form class="site-header__search-form" id="searchForm" method="get" aria-hidden="true" role="search" action="https://Drunkar.github.io/">
				<input class="site-header__search-input" type="text" name="s" placeholder="検索...">
			</form>
		</div>
		<div class="site-header__col-right">
			<div class="site-header__search-button" id="searchBtn">
				<i class="fa fa-search" id="searchBtnIcon"></i>
				<button class="screen-reader-text">検索</button>
			</div>
					</div>
	</div>
		<div class="site-header__image">
		<div class="header-image" style="background-image: url(https://sekailab.com/wp-content/uploads/2018/01/banner-03-03.png)"></div>
	</div>
		</header>
		<div class="site-main-article">
		<main class="content" id="main" role="main">
						<article id="post-1470" class="post-1470 post type-post status-publish format-standard has-post-thumbnail hentry category-articles tag-docker tag-python tag-top-posts" itemscope itemtype="http://schema.org/BlogPosting" itemref="data-site">
				<nav>
					<ul class="breadcrumbs" itemscope itemtype="http://schema.org/BreadcrumbList">
												<li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem"><a href="https://Drunkar.github.io/" rel="home" itemprop="item"><span itemprop="name">ホーム</span></a><meta itemprop="position" content="1"></li>
												<li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem"><a href="https://Drunkar.github.io/category/articles/" itemprop="item"><span itemprop="name">articles</span></a><meta itemprop="position" content="2"></li>
						<li class="current" itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem"><span itemprop="item name">docker swarmのマルチホスト環境でnginxでダイナミックにリバースプロキシする</span><meta itemprop="position" content="3"></li>
					</ul>
				</nav>
				<header class="post__header">
										<div class="post__thumb" itemprop="image" itemscope itemtype="http://schema.org/ImageObject">
						<img width="507" height="268" src="https://Drunkar.github.io/wp-content/uploads/2015/05/dynamic_proxy_multihost_s.png" class="attachment-large size-large wp-post-image" alt="" itemprop="thumbnail" decoding="async" srcset="https://Drunkar.github.io/wp-content/uploads/2015/05/dynamic_proxy_multihost_s.png 507w, https://Drunkar.github.io/wp-content/uploads/2015/05/dynamic_proxy_multihost_s-300x159.png 300w" sizes="(max-width: 507px) 100vw, 507px" />						<meta itemprop="name" content="">
						<meta itemprop="url" content="https://Drunkar.github.io/wp-content/uploads/2015/05/dynamic_proxy_multihost_s.png">
						<meta itemprop="width" content="507">
						<meta itemprop="height" content="268">
					</div>
															<div class="post__meta">
											<div class="post__meta-top">
							<span class="meta-top__cat"><a href="https://Drunkar.github.io/category/articles/" itemprop="genre">articles</a></span>
							<time class="meta-top__date" datetime="2015-05-31T10:27:21+09:00" itemprop='datePublished'>2015年5月31日</time>
							<span class="meta-top__author" itemscope itemtype="http://schema.org/Person" itemprop="author">by Drunkar<meta itemprop="name" content="Drunkar"></span>
						</div>
						<h1 class="post__title" itemprop="headline">docker swarmのマルチホスト環境でnginxでダイナミックにリバースプロキシする</h1>
					</div>
				</header>
                                <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- article-start -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-7499184562108487"
     data-ad-slot="2454853744"
     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
				<div class="post__main">
					<div id="main-content" class="post__content" itemprop="articleBody">
						<p>software design 2014年12月号のDocker特集で、nginx + redisでダイナミックにリバースプロキシする方法が紹介されていました。</p>
<p>[amazonjs asin=&#8221;B00P1IQ8FC&#8221; locale=&#8221;JP&#8221; title=&#8221;Software Design (ソフトウェア デザイン) 2014年 12月号 雑誌&#8221;]</p>
<p>コンテナが追加されるたびに、定期実行しているプログラムでコンテナのローカルアドレスをredisに追加し、nginx-extras + lua moduleを使ってサブドメイン指定で対象コンテナにリバースプロキシするという感じ。コンテナを壊しては作るという変化の激しい状況にあって、いちいちリバースプロキシ先を追加することなく開発環境を管理できるというスグレモノです。</p>
<p>ですが、マルチホスト環境では勝手が違ってきます。たくさんのアプリケーションを走らせたいならばdockerをマルチホストに展開することは必須であるし、そのような状況でもシングルホストのdocker環境と同じように扱いたいものです。</p>
<p>というわけで動的リバースプロキシ環境を、docker swarmをマルチホストに展開させた状況で構築してみました。</p>
<p>まず、シングルホストの構成を再確認してみましょう。SDのやつよりも、下記のブログで紹介されているものの方が良さげ(goの代わりにpythonを使いAPIに接続している)だったのでそちらに即しています。</p>
<blockquote><p>nginxでダイナミックにリバースプロキシするやつ &#8211; はわわーっ: <a href="http://yomi322.hateblo.jp/entry/2015/02/01/195917" target="_blank" rel="noopener noreferrer">http://yomi322.hateblo.jp/entry/2015/02/01/195917</a></p></blockquote>
<figure id="attachment_1484" aria-describedby="caption-attachment-1484" style="width: 768px" class="wp-caption aligncenter"><a href="https://sekailab.com/wp/wp-content/uploads/2015/05/dynamic_proxy_single.png"><img decoding="async" class="wp-image-1484 size-full" src="https://sekailab.com/wp/wp-content/uploads/2015/05/dynamic_proxy_single.png" alt="dynamic_proxy_single" width="768" height="362" srcset="https://Drunkar.github.io/wp-content/uploads/2015/05/dynamic_proxy_single.png 768w, https://Drunkar.github.io/wp-content/uploads/2015/05/dynamic_proxy_single-300x141.png 300w" sizes="(max-width: 768px) 100vw, 768px" /></a><figcaption id="caption-attachment-1484" class="wp-caption-text">シングルホストでのダイナミックリバースプロキシ構成</figcaption></figure>
<p>&nbsp;</p>
<ol>
<li>containerがrun/stop/startされる度に記録されるapiのイベントをpythonで読み込み、「コンテナのアドレスとexposeされているポート」を、「コンテナ起動時に環境変数として与えた名前」をキーとしてredisに登録します。</li>
<li>nginxにユーザーが&#8221;アプリ名.nginx.ip.add.ress.xip.io&#8221;みたいな感じでサブドメインアクセスしてきたらアプリ名をキーとしてredisにアドレス・ポートを問い合わせ、lua moduleでリバースプロキシ先を書き換えます。</li>
</ol>
<p>マルチホストでこの構成を作る時に問題となったのは、以下の2つでした。</p>
<ul>
<li>リバースプロキシ先がdockerネットワークであるので、別ホストに飛ばした上でそのホストのdockerネットワークに飛ばすという2段のプロキシが必要</li>
<li>アクセス窓口になるコンテナなど、特定のホストに特定の役割を持ったコンテナをリリース出来なければならない</li>
</ul>
<p>1つめの問題は、すべてのホストに上記nginx+redis+pythonスクリプト構成をデプロイすることで解決出来ます。(他にもっとスマートな方法もあるのかもしれませんが思いつきませんでした。)アクセス先のコンテナが自ホストで動いていない場合は、対象となるホストのnginxにリバースプロキシするようにすれば、それぞれのnginxが自ホストのコンテナを把握していれば事足ります。</p>
<p>ただし、最初にアクセスするnginxのホストでは、アクセスを各ホストに振り分けるために、「dockerクラスタの全コンテナがそれぞれどのホストで動いているか」を把握していなければなりません。幸い、これはdocker swarmのapiで取得できるので、docker swarm managerのホストにこの「窓口となるnginx」を配置します。</p>
<figure id="attachment_1494" aria-describedby="caption-attachment-1494" style="width: 1018px" class="wp-caption aligncenter"><a href="https://sekailab.com/wp/wp-content/uploads/2015/05/dynamic_proxy_multihost.png"><img decoding="async" class="wp-image-1494 size-full" src="https://sekailab.com/wp/wp-content/uploads/2015/05/dynamic_proxy_multihost.png" alt="dynamic_proxy_multihost" width="1018" height="538" srcset="https://Drunkar.github.io/wp-content/uploads/2015/05/dynamic_proxy_multihost.png 1018w, https://Drunkar.github.io/wp-content/uploads/2015/05/dynamic_proxy_multihost-300x159.png 300w, https://Drunkar.github.io/wp-content/uploads/2015/05/dynamic_proxy_multihost-768x406.png 768w" sizes="(max-width: 1018px) 100vw, 1018px" /></a><figcaption id="caption-attachment-1494" class="wp-caption-text">docker swarmクラスタでのダイナミックリバースプロキシ構成</figcaption></figure>
<p>docker swarmクラスタの構築はここでは詳しくは触れませんが、下記記事などが参考になります。</p>
<blockquote><p>Docker Swarmでクラスタを構築する &#8211; Qiita: <a href="http://qiita.com/atsaki/items/16c50dfd579a9339c333" target="_blank" rel="noopener noreferrer">http://qiita.com/atsaki/items/16c50dfd579a9339c333</a></p></blockquote>
<p>そして、docker managerホストにリリースするコンテナと他ホストのコンテナをrun時に設定するnameで区別出来るようにするため、出来ればrun時にホストを選択したいです。これは、docker swarmのfilterという機能を使います。</p>
<blockquote><p>Swarm filters &#8211; Docker Documentation: https://docs.docker.com/swarm/scheduler/filter/</p></blockquote>
<p>要するに、docker daemonの起動オプションとして &#8220;&#8211;label&#8221;を追加すれば、docker swarmを利用したrun時に指定したlabelを持ったホスト群のどれかにリリース出来る、という機能です。</p>
<p>docker swarm managerホストには&#8221;node_type=manager&#8221;ラベルを、それ以外には&#8221;node_type=worker&#8221;ラベルを付与し、コンテナのrun時に&#8221;-e constraint:node_type==manager&#8221;オプションを付与すれば、docker swarmでも確実にmanagerホストにコンテナをリリース出来るというわけです。</p>
<p>という訳でゴタクを並べてきましたが、実際に作ってみましょう。</p>
<ol>
<li><a href="#index-1">docker swarmクラスタの構築</a></li>
<li><a href="#index-2">ディレクトリの作成</a></li>
<li><a href="#index-3">managerのリバースプロキシ環境を作成</a></li>
<li><a href="#index-4">workerのリバースプロキシ環境を作成</a></li>
</ol>
<p>3つのホストで構成されるネットワークを考えてみます。</p>
<table style="height: 161px; padding-left: 30px;" width="633">
<thead>
<tr>
<th>ホスト名</th>
<th>IPアドレス</th>
<th>swarmノードタイプ</th>
<th>wordpressコンテナの名前</th>
</tr>
</thead>
<tbody>
<tr>
<td>comet</td>
<td>192.168.100.11</td>
<td>manager</td>
<td>comet-blog</td>
</tr>
<tr>
<td>meteor</td>
<td>192.168.100.12</td>
<td>worker</td>
<td>meteor-blog</td>
</tr>
<tr>
<td>planet</td>
<td>192.168.100.13</td>
<td>worker</td>
<td>planet-blog</td>
</tr>
</tbody>
</table>
<p>ホスト名の意味はごくごく一部の人にしか伝わらない<a id="annotate-1" href="#annotation-1"><sup>※</sup></a>と思いますのでスルーしてください。それぞれのホストで1台ずつwordpressが動いているとします。この時、各ホストのredisには以下の情報が保存されるようになります。</p>
<table style="height: 253px; padding-left: 30px;" width="1033">
<thead>
<tr style="padding-left: 30px;">
<th style="padding-left: 30px;">ホスト名</th>
<th style="padding-left: 30px;">key1</th>
<th style="padding-left: 30px;">value1</th>
<th style="padding-left: 30px;">key2</th>
<th style="padding-left: 30px;">value2</th>
<th style="padding-left: 30px;">key3</th>
<th style="padding-left: 30px;">value3</th>
</tr>
</thead>
<tbody style="padding-left: 30px;">
<tr style="padding-left: 30px;">
<td style="padding-left: 30px;">comet</td>
<td style="padding-left: 30px;">comet-blog</td>
<td style="padding-left: 30px;">コンテナのIPアドレス:ポート</td>
<td style="padding-left: 30px;">meteor-blog</td>
<td style="padding-left: 30px;">192.168.100.12:80</td>
<td style="padding-left: 30px;">planet-blog</td>
<td style="padding-left: 30px;">192.168.100.13:80</td>
</tr>
<tr style="padding-left: 30px;">
<td style="padding-left: 30px;">meteor</td>
<td style="padding-left: 30px;">meteor-blog</td>
<td style="padding-left: 30px;">コンテナのIPアドレス:ポート</td>
<td style="padding-left: 30px;"></td>
<td style="padding-left: 30px;"></td>
<td style="padding-left: 30px;"></td>
<td style="padding-left: 30px;"></td>
</tr>
<tr style="padding-left: 30px;">
<td style="padding-left: 30px;">planet</td>
<td style="padding-left: 30px;">planet-blog</td>
<td style="padding-left: 30px;">コンテナのIPアドレス:ポート</td>
<td style="padding-left: 30px;"></td>
<td style="padding-left: 30px;"></td>
<td style="padding-left: 30px;"></td>
<td style="padding-left: 30px;"></td>
</tr>
</tbody>
</table>
<div id="toc_container" class="no_bullets"><p class="toc_title">Contents</p><ul class="toc_list"><li></li><li></li><li></li><li></li></ul></div>
<h2 id="index-1"><span id="1_docker_swarm">1. docker swarmクラスタの構築</span></h2>
<p>dockerをインストールしたら、/etc/default/dockerに下記起動時オプションを追記します。</p>
<pre><code class="shell">DOCKER_OPTS="-H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock --label node_type=manager"</code></pre>
<p>workerノードの場合は &#8220;node_type=worker&#8221;とします。次に、全ノードでswarm イメージをpullします。</p>
<pre><code class="shell">$ sudo docker pull swarm</code></pre>
<p>いずれかのホストでswarmクラスタを作成します。</p>
<pre><code class="shell">$ sudo docker run --rm swarm create</code></pre>
<p>この時発行されるtokenがCLUSTER_IDとなります。ホストをswarmクラスタに参加させるため、すべてのホストで下記を実行します。</p>
<pre><code class="shell">$ sudo docker run -d swarm join --addr=172.17.8.102:2375 token://&lt;CLUSTER_ID&gt;</code></pre>
<p>managerとなるホスト(comet)で以下を実行します。</p>
<pre><code class="shell">$ sudo docker run -d -p 2377:2375 swarm manage  token://&lt;CLUSTER_ID&gt;</code></pre>
<p>これでdocker swarmクラスタが構築できました。managerノードで-H オプションをつけることで、今まで通りのdockerコマンドでクラスタ全体を扱うことが出来ます。</p>
<pre><code class="shell">$ sudo docker -H tcp://Drunkar.github.io:2377 info</code></pre>
<h2 id="index-2"><span id="2">2. ディレクトリの作成</span></h2>
<p>docker swarmでコンテナをrunした時、クラスタに所属するノードのいずれかにコンテナがリリースされます。コンテナはいつでも停止できる状態にするのがベストプラクティスですので、nginxの設定ファイルやmysqlのデータはdockerのVOLUME機能を使用してホストと共有することになると思います。例えばホスト meteor上に/home/meteor/jenkinsみたいなディレクトリを用意して、以下のようにおじさんを起動するとします。</p>
<pre><code class="shell">$ sudo docker -H tcp://0.0.0.0:2377 run --name jenkins -d -v /home/meteor/jenkins:/var/jenkins_home -e JAVA_OPTS='-Duser.timezone=Asia/Tokyo -Dfile.encoding=UTF-8 -
Dsun.jnu.encoding=UTF-8' jenkins</code></pre>
<p>この時リリース先がcometまたはplanetであったなら、そんなディレクトリは存在ないのでrunに失敗してしまいます。docker swarmでクラスタを構築するにあたっては、共通のディレクトリを用意しておくのが良いです。ここでは /docker_volumes というディレクトリを全ホストで作っておくことにします。</p>
<pre><code class="shell">$ sudo mkdir /docker_volumes</code></pre>
<h2 id="index-3"><span id="3_manager">3. managerのリバースプロキシ環境を作成</span></h2>
<p>まず、redisをupstreamsという名前で起動します。名前SDの記事に準じますがお好みで。最初にお話したように、constraintを与えることによりmanagerホストで起動させます。</p>
<pre><code class="shell">$ sudo docker -H tcp://0.0.0.0:2377 run -e constraint:node_type==manager --name upstreams -P -d redis</code></pre>
<p>次にnginxを起動するのですが、<a href="https://registry.hub.docker.com/_/nginx/" target="_blank" rel="noopener noreferrer">公式のnginx image</a>はrua_moduleをインストールしていないので、自分でimageを作る必要があります。docker swarmは現時点でbuildをサポートしていないため、下記Dockerfileを作り、全ホストで同名imageをbuildするか、「build後dockerhub or プライベートなdocker registryにpushしたimage」をswarmのコマンドでpullするかする必要があります。</p>
<pre><code class="shell">FROM ubuntu:trusty

# Install Nginx.
RUN apt-get update &amp;&amp; \
    apt-get -y install nginx-extras lua-nginx-redis &amp;&amp; \
    rm -rf /var/lib/apt/lists/*

RUN rm /etc/nginx/sites-enabled/default
RUN chown -R www-data:www-data /var/lib/nginx

# Define mountable directories.
VOLUME ["/var/log/nginx"]

# Define working directory.
WORKDIR /etc/nginx

# Define default command.
CMD ["nginx", "-g", "daemon off;"]

# Expose ports.
EXPOSE 80 443</code></pre>
<p>imageが全ホストに存在する状態になったなら、cometに/docker_volumes/dproxyディレクトリ、/docker_volumes/dproxy/logディレクトリを作成し、/docker_volumes/dproxy配下に下記のnginx.confを作成します。</p>
<pre><code>user www-data;

env DOCKER_NETWORK_ADDR;
env REDIS_PORT_6379_TCP_ADDR;
env REDIS_PORT_6379_TCP_PORT;

error_log  /var/log/nginx/error.log;
pid        /var/run/nginx.pid;

events {
    worker_connections  768;
}

http {
    include       /etc/nginx/mime.types;
    default_type application/octet-stream;
    access_log  /var/log/nginx/access.log;
    sendfile        on;
    keepalive_timeout  65;
    tcp_nodelay        on;
    gzip  on;
    gzip_disable "MSIE [1-6]\.(?!.*SV1)";
    include /etc/nginx/conf.d/*.conf;
    include /etc/nginx/sites-enabled/*;

    server {
        listen 80 default_server;
        root /usr/share/nginx/html;
        index index.html index.htm;
        location / {
            set $upstream "";
            rewrite_by_lua '
                local redis = require "nginx.redis"
                local client = redis:new()
                local docker_net_addr = os.getenv("DOCKER_NETWORK_ADDR")
                subdomain, _ = string.gsub(ngx.var.host, "([^%.]+)%..*", "%1")
                local redis_host = os.getenv("REDIS_PORT_6379_TCP_ADDR")
                local redis_port = os.getenv("REDIS_PORT_6379_TCP_PORT")
                local ok, err = client:connect(redis_host, redis_port)
                if not ok then
                    ngx.exit(ngx.HTTP_SERVICE_UNAVAILABLE)
                end

                local res, err = client:get(subdomain)
                if err then
                    ngx.exit(ngx.HTTP_SERVICE_UNAVAILABLE)
                end
                if res == ngx.full then
                    ngx.exit(ngx.HTTP_NOT_FOUND)
                else

                    ip_1, _ = string.gsub(res, "([^%.]+)%.([^%.]+)%.([^%.]+)%.([^%.]+):.*", "%1")
                    ip_2, _ = string.gsub(res, "([^%.]+)%.([^%.]+)%.([^%.]+)%.([^%.]+):.*", "%2")
                    ip_3, _ = string.gsub(res, "([^%.]+)%.([^%.]+)%.([^%.]+)%.([^%.]+):.*", "%3")
                    ip_4, _ = string.gsub(res, "([^%.]+)%.([^%.]+)%.([^%.]+)%.([^%.]+):.*", "%4")
                    local ip_addr         = ip_1.."."..ip_2.."."..ip_3.."."..ip_4
                    local ip_addr_network = ip_1.."."..ip_2..".0.0"


                    if ip_addr_network ~= docker_net_addr then
                        forward_ip, _ = string.gsub(res, "([^:]+):([0-9]+)", "%1")
                        port, _ = string.gsub(res, "([^:]+):([0-9]+)", "%2")
                        ngx.var.upstream = ip_addr
                    else
                        ngx.var.upstream = res
                    end
                end
            ';

            proxy_set_header    Host              $host;
            proxy_set_header    X-Real-IP         $remote_addr;
            proxy_set_header    X-Forwarded-Host  $host;
            proxy_set_header    X-Forwarded-For   $proxy_add_x_forwarded_for;
            proxy_set_header    X-Forwarded-Proto $scheme;
            proxy_redirect      off;
            proxy_max_temp_file_size    0;
            proxy_pass http://$upstream;
       }
    }
}</code></pre>
<p>サブドメインをキーとしてredisから取得した値のネットワークアドレスが、環境変数DOCKER_NETWORK_ADDRと異なるならば、対象ネットワークに、そうでないならそのままredisから呼び出したIPアドレス:ポート番号にリバースプロキシする、という感じです。</p>
<p>image名がdrunkar/nginx-extrasであったなら、下記コマンドでdproxyという名前でnginxを起動します。起動時にDOCKER_NETWORK_ADDRという名前の環境変数を渡していますが、これはcometのdockerネットワークのアドレスです。</p>
<pre><code class="shell">$ sudo docker -H tcp://0.0.0.0:2377 run -e constraint:node_type==manager --name dproxy -d -p 80:80 -p 443:443 -e DOCKER_NETWORK_ADDR=172.17.0.0 -v /docker_volumes/dproxy/nginx.conf:/etc/nginx/nginx.conf:ro -v /docker_volumes/dproxy/log:/var/log/nginx -d --link upstreams:redis drunkar/nginx-extras</code></pre>
<p>このdockerネットワークのアドレスは、先ほど起動したupstreamsをinspectすることで見ることが出来ます。</p>
<pre><code class="shell">$ sudo docker -H tcp://0.0.0.0:2377 inspect upstreams</code></pre>
<p>表示される結果のうち、&#8221;NetworkingSettings&#8221;下に僕の場合は&#8221;IPAddress&#8221;: &#8220;172.17.0.3&#8221;、&#8221;IPPrefixLen&#8221;: 16 とあったので、172.17.0.0をネットワークアドレスとして渡しています。ちなみにここで表示される結果のうち、&#8221;Node&#8221;という項目はdocker swarmに特有のもので、これによりコンテナの起動しているホストと、ホストのIPアドレスを取得することが出来ます。後述するPythonスクリプトの内部ではここを利用しています。</p>
<p>では、最後にredisの情報を更新するPythonスクリプトを走らせるコンテナを起動します。Pythonでdocker apiとredisにアクセスするために、dockerモジュールとredisモジュールをインストールしたimageを作る必要があります。下記のDockerfileにより作成します。</p>
<pre><code class="shell">FROM python:3-onbuild
CMD [ "python", "-u", "./linked.py" ]</code></pre>
<p>Dockerfileと同じディレクトリに、インストールしたいモジュールを列挙したrequirements.txtを置いていれば、build時にモジュールをインストールしてくれます。便利。</p>
<pre><code class="txt">docker-py
redis</code></pre>
<p>imageが出来たら、下記のlinked.pyを/docker_volumes/linked.pyに配置します。</p>
<pre><code class="python">#!/usr/bin/python3

import datetime
import docker
import json
import os
import redis
import sys
import urllib.request


HOST_IP = os.getenv('HOST_IP')
DOCKER_HOST = os.getenv('DOCKER_HOST')
DOCKER_API_BASE_URL = 'tcp://' + DOCKER_HOST
DOCKER_EVENT_API_URL = 'http://' + DOCKER_HOST + '/events'
REDIS_ADDR = os.getenv('REDIS_PORT_6379_TCP_ADDR')
REDIS_PORT = os.getenv('REDIS_PORT_6379_TCP_PORT')

CLIENT = docker.Client(base_url=DOCKER_API_BASE_URL)
EVENT = urllib.request.urlopen(DOCKER_EVENT_API_URL)
REDIS = redis.Redis(host=REDIS_ADDR, port=REDIS_PORT)


def getforwardinfo(container):
    inspect = CLIENT.inspect_container(container.get('Id'))
    env = inspect.get('Config').get('Env')

    name = next(filter(lambda x: 'DPROXY_FORWARD_NAME' in x, env), None)
    if name is None:
        return None
    name = name.split('=').pop()

    # if swarm manager node
    if 'Node' in inspect:
        nodeip = inspect.get('Node').get('Ip')

        if nodeip != HOST_IP:
            ipaddr = nodeip
            port = '80'
        else:
            ipaddr = inspect.get('NetworkSettings').get('IPAddress')
            port = str(container.get('Ports').pop().get('PrivatePort'))

    else:
        ipaddr = inspect.get('NetworkSettings').get('IPAddress')
        port = str(container.get('Ports').pop().get('PrivatePort'))

    forward = ipaddr + ':' + port
    return (name, forward)


def updateredis():
    info = []
    for c in CLIENT.containers():
        tmp = getforwardinfo(c)        if tmp is None:
            continue
        info.append(tmp)

    REDIS.flushall()
    for name, forward in info:
        REDIS.set(name, forward)


def dumpredis():
    print(datetime.datetime.now().ctime())
    for k in REDIS.scan_iter():
        s = "%10s:\t%s" % (k.decode('utf-8'), REDIS.get(k).decode('utf-8'))
        print(s)


def readevent():
    x = []
    bracket_count = 0
    while True:
        c = EVENT.read(1)
        x.append(c)
        if c == b'{':
            bracket_count += 1
        elif c == b'}':
            bracket_count -= 1
            if bracket_count == 0:
                break
    return b''.join(x).decode('utf-8')


def main():
    updateredis()
    dumpredis()
    while True:
        ev = readevent()
        status = json.loads(ev).get('status')
        if status in ('start', 'stop'):
            updateredis()
            dumpredis()


if __name__ == '__main__':
    main()
    exit(0)</code></pre>
<p>DOCKER_HOSTで渡されたアドレスにAPIアクセスしてイベントを取得し、NodeのIPアドレスがDOCKER_MANAGER_HOST_IPで渡されたアドレス(cometのアドレス)と異なるならば、NodeのIPアドレスをredisに登録するようになっています。同じならばNetoworkSettingsのIPAddressとPortsのPrivatePortを登録します。ちなみに、このスクリプトはworkerホストでも動くようにしています。workerの場合はswarmではなく自ホストのdocker apiにアクセスし、Nodeプロパティが無いことでswarm apiでないと認識してIPAddressとPortsのPrivatePortを登録します。</p>
<p>先ほどbuildしたimage (drunkar/linked-pyとします)からコンテナを起動します。</p>
<pre><code class="shell">$ sudo docker -H tcp://0.0.0.0:2377 run -e constraint:node_type==manager --name linked -d -v /docker_volumes/linked/linked.py:/linked.py --link upstreams:redis -e DOCKER_MANAGER_HOST_IP=192.168.100.11 -e DOCKER_HOST=172.17.42.1:2377 drunkar/linked-py</code></pre>
<p>これで、cometでの環境構築は終了です。シングルホストのダイナミックリバースプロキシと同様に利用できることを確認しましょう。</p>
<pre><code class="shell">$ sudo docker -H tcp://0.0.0.0:2377 run -e constraint:node_type==manager -d -P --name comet-blog-db -e MYSQL_ROOT_PASSWORD=cometpass mysql
$ sudo docker -H tcp://0.0.0.0:2377 run -e constraint:node_type==manager -d -P --name foo -e DPROXY_FORWARD_NAME=comet-blog --link comet-blog-db:mysql wordpress</code></pre>
<p>DPROXY_FORWARD_NAMEで渡す名前をサブドメインとしてアクセスすることで、wordpressが開けると思います。やったね！</p>
<h2 id="index-4"><span id="4_worker">4. workerのリバースプロキシ環境の作成</span></h2>
<p>もうそろそろゴールしたい感じですが、workerの設定は一瞬です。設定ファイルやスクリプトはmanagerのものと同じものが使えます。redis、nginxはnode_typeがworkerになるだけで、起動方法も一緒です。Pythonスクリプトの起動は下記のようになります(meteorでの例)。</p>
<pre><code class="shell">$ sudo docker run --name linked_worker_1 -d -v /docker_volumes/linked/linked.py:/linked.py --link upstreams_worker_1:redis -e HOST_IP=192.168.100.12 -e DOCKER_HOST=172.17.42.1:2375 drunkar/linked-py</code></pre>
<p>swarmからの起動でないことに注意してください。HOST_IPを指定する必要があるので、各ホストで実行する必要があります。</p>
<p>以上で完了です！開発環境を作りまくって、リバースプロキシしまくりです。残る課題として、nginxにリバースプロキシ部がipアドレスでのアクセスにしか対応していないので、ホスト名でのアクセスに対応するにはluaをいじる必要があります。個人的にlua耐性が著しく低かったので、これが精一杯でした。。。</p>
<p id="annotation-1" style="padding-left: 30px;"><span style="font-size: 12px;"><a href="#annotate-1">※ コメットさん☆は名作です</a></span></p>
					</div>
					<footer class="post__sidebar" data-sticky-container>
						<div class="sticky-content" data-sticky data-anchor="main-content" data-check-every="0">
																					<ul class="post__tags"><li><a href="https://Drunkar.github.io/tag/docker/" rel="tag">docker</a></li><li><a href="https://Drunkar.github.io/tag/python/" rel="tag">python</a></li><li><a href="https://Drunkar.github.io/tag/top-posts/" rel="tag">top-posts</a></li></ul>							<meta itemprop="keywords" content="docker, python, top-posts, ">
																											</div>
					</footer>
				</div>
                                <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- before_pagenation -->
<ins class="adsbygoogle"     style="display:block"
     data-ad-client="ca-pub-7499184562108487"     data-ad-slot="9639209196"     data-ad-format="auto"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>
				<nav>
										<ul class="post__preview-next">
												<li>
							<a href="https://Drunkar.github.io/2015/02/01/logo-beats/">
								<i class="fa fa-angle-left"></i>
								<span class="screen-reader-text">過去の投稿へ</span>
							</a>
						</li>
						 						 						<li>
							<a href="https://Drunkar.github.io/2015/06/21/anaconda-pycaffe-caffe-docker-ami/">
								<i class="fa fa-angle-right"></i>
								<span class="screen-reader-text">次の投稿へ</span>
							</a>
						</li>
											</ul>
				</nav>
			</article>
										<div class="related-post">
		<h2>関連記事</h2>
		<div class="related-post__container">
								<div class="related-post__item">
													<a class="related-post__item-thumb" href="https://Drunkar.github.io/2021/06/02/how-to-keep-higher-fitbit-sleep-score/" style="background-image: url('https://Drunkar.github.io/wp-content/uploads/2021/06/Screenshot_20210517-114704_Fitbit.jpg');"></a>
												<h3 class="related-post__item-title"><a href="https://Drunkar.github.io/2021/06/02/how-to-keep-higher-fitbit-sleep-score/">fitbitの睡眠スコアを90弱で安定させる良い睡眠を続ける簡単な方法</a></h3>
						<time class="related-post__item-date timeago" id="relatedPostDate" datetime="2021-06-02T19:39:08+09:00">20210602</time>
					</div>
									<div class="related-post__item">
													<a class="related-post__item-thumb" href="https://Drunkar.github.io/2021/05/27/m1-ipad-pro-12-9-2021-best-usb-c-hub/" style="background-image: url('https://Drunkar.github.io/wp-content/uploads/2021/05/20210524_123510.jpg');"></a>
												<h3 class="related-post__item-title"><a href="https://Drunkar.github.io/2021/05/27/m1-ipad-pro-12-9-2021-best-usb-c-hub/">m1 ipad pro 12.9 2021のusb-cハブはコレがベスト</a></h3>
						<time class="related-post__item-date timeago" id="relatedPostDate" datetime="2021-05-27T18:30:02+09:00">20210527</time>
					</div>
									<div class="related-post__item">
													<a class="related-post__item-thumb" href="https://Drunkar.github.io/2021/05/04/downgrade-mac-osx-to-play-genshin/" style="background-image: url('https://Drunkar.github.io/wp-content/uploads/2021/05/E0MkZlWUUAI0kDw.jpg');"></a>
												<h3 class="related-post__item-title"><a href="https://Drunkar.github.io/2021/05/04/downgrade-mac-osx-to-play-genshin/">Time Machine不要！Macを11.2.3にダウングレードして原神をm1 macbook airでプレイする</a></h3>
						<time class="related-post__item-date timeago" id="relatedPostDate" datetime="2021-05-04T16:18:10+09:00">20210504</time>
					</div>
									<div class="related-post__item">
													<a class="related-post__item-thumb" href="https://Drunkar.github.io/2021/02/23/mhz19c-m5stickc-co2-monitoring/" style="background-image: url('https://Drunkar.github.io/wp-content/uploads/2021/02/EtwpwVtU0AAUD7E.jpg');"></a>
												<h3 class="related-post__item-title"><a href="https://Drunkar.github.io/2021/02/23/mhz19c-m5stickc-co2-monitoring/">MH-Z19CとM5StickCで二酸化炭素濃度モニタリング</a></h3>
						<time class="related-post__item-date timeago" id="relatedPostDate" datetime="2021-02-23T19:25:31+09:00">20210223</time>
					</div>
									<div class="related-post__item">
													<a class="related-post__item-thumb" href="https://Drunkar.github.io/2021/01/04/avegant-glyph-hack-binzume-altglyph/" style="background-image: url('https://Drunkar.github.io/wp-content/uploads/2021/01/20210102_223754.jpg');"></a>
												<h3 class="related-post__item-title"><a href="https://Drunkar.github.io/2021/01/04/avegant-glyph-hack-binzume-altglyph/">【神軽量HMD】Avegant Glyph 改造: 瓶詰堂さんのaltglyphを作った</a></h3>
						<time class="related-post__item-date timeago" id="relatedPostDate" datetime="2021-01-04T21:04:30+09:00">20210104</time>
					</div>
									<div class="related-post__item">
													<a class="related-post__item-thumb" href="https://Drunkar.github.io/2020/08/24/pc-ipad-android-switch-usb-c-hub/" style="background-image: url('https://Drunkar.github.io/wp-content/uploads/2020/08/20200824_192601.jpg');"></a>
												<h3 class="related-post__item-title"><a href="https://Drunkar.github.io/2020/08/24/pc-ipad-android-switch-usb-c-hub/">PC、iPad、Android、switchもドックいらず！あまりに万能なusb-cハブが最強だった</a></h3>
						<time class="related-post__item-date timeago" id="relatedPostDate" datetime="2020-08-24T19:30:38+09:00">20200824</time>
					</div>
						</div>
	</div>
			
<div class="comment" itemscope itemtype="http://schema.org/Comment">
	<h2>コメント</h2>
	<div class="comments">
			<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">コメントを返信する <small><a rel="nofollow" id="cancel-comment-reply-link" href="/wordpress/2015/05/31/docker-swarm-nginx-dynamix-reverse-proxy/#respond" style="display:none;">コメントをキャンセル</a></small></h3><form action="https://Drunkar.github.io/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate><p class="comment-notes"><span id="email-notes">メールアドレスが公開されることはありません。</span> <span class="required-field-message"><span class="required">※</span> が付いている欄は必須項目です</span></p><textarea id="comment" name="comment" placeholder="コメント"></textarea><input name="author" type="text" value="" placeholder="名前 *" aria-required='true'>
<input name="email" type="text" value="" placeholder="メール *" aria-required='true'>
<input name="url" type="text" value="" placeholder="ウェブ">
<p class="form-submit"><input name="submit" type="submit" id="submit" class="button" value="送信" /> <input type='hidden' name='comment_post_ID' value='1470' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="a7ca384a2e" /></p><p style="display: none !important;" class="akismet-fields-container" data-prefix="ak_"><label>&#916;<textarea name="ak_hp_textarea" cols="45" rows="8" maxlength="100"></textarea></label><input type="hidden" id="ak_js_1" name="ak_js" value="5"/><script>document.getElementById( "ak_js_1" ).setAttribute( "value", ( new Date() ).getTime() );</script></p></form>	</div><!-- #respond -->
		</div>
</div>
		</main>
		<aside class="sidebar">
	<div id="custom_html-3" class="widget_text sidebar-widgetarea widget widget_custom_html"><div class="textwidget custom-html-widget"><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- top-right-rectangle -->
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-7499184562108487"
     data-ad-slot="9172251435"
     data-ad-format="auto"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script></div></div><div id="custom_html-4" class="widget_text sidebar-widgetarea widget widget_custom_html"><div class="textwidget custom-html-widget"><a href="https://twitter.com/Drunkar" target="_blank" alt="twitter"><i class="fa fa-twitter sns-icon" aria-hidden="true"></i></a>
<a href="https://github.com/Drunkar" target="_blank" alt="github"><i class="fa fa-github-alt sns-icon" aria-hidden="true"></i></a>
<a href="https://www.youtube.com/channel/UC-xLrT7riY0qTlqjOvxtX2w" target="_blank" alt="youtube"><i class="fa fa-youtube sns-icon" aria-hidden="true"></i></a>
<a href="https://500px.com/drunkarsp" target="_blank" alt="500px"><i class="fa fa-500px sns-icon" aria-hidden="true"></i></a>
<a href="https://www.thingiverse.com/Drunkar/designs" target="_blank" alt="thingiverse"><i class="fa fa-cube sns-icon" aria-hidden="true"></i></a></div></div>
<div id="wpp-2" class="sidebar-widgetarea widget popular-posts">
<h2 class="widgettitle">人気の投稿</h2>
<ul class="wpp-list wpp-list-with-thumbnails">
<li>
<a href="https://Drunkar.github.io/2021/05/27/m1-ipad-pro-12-9-2021-best-usb-c-hub/" title="m1 ipad pro 12.9 2021のusb-cハブはコレがベスト" target="_self"><img src="https://Drunkar.github.io/wp-content/plugins/wordpress-popular-posts/assets/images/no_thumb.jpg" width="75" height="75" alt="" class="wpp-thumbnail wpp_featured wpp_def_no_src" decoding="async" loading="lazy"></a>
<a href="https://Drunkar.github.io/2021/05/27/m1-ipad-pro-12-9-2021-best-usb-c-hub/" title="m1 ipad pro 12.9 2021のusb-cハブはコレがベスト" class="wpp-post-title" target="_self">m1 ipad pro 12.9 2021のusb...</a>
</li>
</ul>
</div>
<div id="tag_cloud-3" class="sidebar-widgetarea widget widget_tag_cloud"><h2 class="widgettitle">タグクラウド</h2>
<div class="tagcloud"><a href="https://Drunkar.github.io/tag/architecture/" class="tag-cloud-link tag-link-3 tag-link-position-1" style="font-size: 18.71875pt;" aria-label="architecture (18個の項目)">architecture</a>
<a href="https://Drunkar.github.io/tag/aws/" class="tag-cloud-link tag-link-48 tag-link-position-2" style="font-size: 13.25pt;" aria-label="aws (5個の項目)">aws</a>
<a href="https://Drunkar.github.io/tag/blender/" class="tag-cloud-link tag-link-132 tag-link-position-3" style="font-size: 14.015625pt;" aria-label="blender (6個の項目)">blender</a>
<a href="https://Drunkar.github.io/tag/blockchain/" class="tag-cloud-link tag-link-135 tag-link-position-4" style="font-size: 12.375pt;" aria-label="blockchain (4個の項目)">blockchain</a>
<a href="https://Drunkar.github.io/tag/cpp/" class="tag-cloud-link tag-link-5 tag-link-position-5" style="font-size: 15.65625pt;" aria-label="c++ (9個の項目)">c++</a>
<a href="https://Drunkar.github.io/tag/design/" class="tag-cloud-link tag-link-51 tag-link-position-6" style="font-size: 12.375pt;" aria-label="design (4個の項目)">design</a>
<a href="https://Drunkar.github.io/tag/docker/" class="tag-cloud-link tag-link-34 tag-link-position-7" style="font-size: 15.65625pt;" aria-label="docker (9個の項目)">docker</a>
<a href="https://Drunkar.github.io/tag/drone/" class="tag-cloud-link tag-link-35 tag-link-position-8" style="font-size: 13.25pt;" aria-label="drone (5個の項目)">drone</a>
<a href="https://Drunkar.github.io/tag/electric/" class="tag-cloud-link tag-link-17 tag-link-position-9" style="font-size: 18.171875pt;" aria-label="electric (16個の項目)">electric</a>
<a href="https://Drunkar.github.io/tag/gcp/" class="tag-cloud-link tag-link-136 tag-link-position-10" style="font-size: 8pt;" aria-label="gcp (1個の項目)">gcp</a>
<a href="https://Drunkar.github.io/tag/graphics/" class="tag-cloud-link tag-link-7 tag-link-position-11" style="font-size: 19.375pt;" aria-label="graphics (21個の項目)">graphics</a>
<a href="https://Drunkar.github.io/tag/javascript/" class="tag-cloud-link tag-link-22 tag-link-position-12" style="font-size: 14.5625pt;" aria-label="javascript (7個の項目)">javascript</a>
<a href="https://Drunkar.github.io/tag/life_hack/" class="tag-cloud-link tag-link-133 tag-link-position-13" style="font-size: 21.5625pt;" aria-label="life_hack (34個の項目)">life_hack</a>
<a href="https://Drunkar.github.io/tag/machine_learning/" class="tag-cloud-link tag-link-20 tag-link-position-14" style="font-size: 20.140625pt;" aria-label="machine_learning (25個の項目)">machine_learning</a>
<a href="https://Drunkar.github.io/tag/make/" class="tag-cloud-link tag-link-42 tag-link-position-15" style="font-size: 19.8125pt;" aria-label="make (23個の項目)">make</a>
<a href="https://Drunkar.github.io/tag/openscad/" class="tag-cloud-link tag-link-44 tag-link-position-16" style="font-size: 9.96875pt;" aria-label="openscad (2個の項目)">openscad</a>
<a href="https://Drunkar.github.io/tag/orange_pi/" class="tag-cloud-link tag-link-137 tag-link-position-17" style="font-size: 13.25pt;" aria-label="orange_pi (5個の項目)">orange_pi</a>
<a href="https://Drunkar.github.io/tag/otaku/" class="tag-cloud-link tag-link-33 tag-link-position-18" style="font-size: 15.109375pt;" aria-label="otaku (8個の項目)">otaku</a>
<a href="https://Drunkar.github.io/tag/processing/" class="tag-cloud-link tag-link-40 tag-link-position-19" style="font-size: 11.28125pt;" aria-label="processing (3個の項目)">processing</a>
<a href="https://Drunkar.github.io/tag/python/" class="tag-cloud-link tag-link-30 tag-link-position-20" style="font-size: 22pt;" aria-label="python (37個の項目)">python</a>
<a href="https://Drunkar.github.io/tag/top-posts/" class="tag-cloud-link tag-link-134 tag-link-position-21" style="font-size: 20.6875pt;" aria-label="top-posts (28個の項目)">top-posts</a>
<a href="https://Drunkar.github.io/tag/ubuntu/" class="tag-cloud-link tag-link-138 tag-link-position-22" style="font-size: 8pt;" aria-label="ubuntu (1個の項目)">ubuntu</a>
<a href="https://Drunkar.github.io/tag/unity/" class="tag-cloud-link tag-link-140 tag-link-position-23" style="font-size: 8pt;" aria-label="Unity (1個の項目)">Unity</a>
<a href="https://Drunkar.github.io/tag/windows/" class="tag-cloud-link tag-link-139 tag-link-position-24" style="font-size: 13.25pt;" aria-label="windows (5個の項目)">windows</a></div>
</div></aside>	</div>

	<footer class="site-footer" id="footer" itemscope itemtype="http://schema.org/WPFooter">
		<div class="footer-widget-area">
			<div class="footer-widget-area-1">
							</div>
		</div>
		<p class="copyright">Copyright 2018 @Drunkar</p>
	</footer>
	<link rel='stylesheet' id='toc-screen-css' href='https://Drunkar.github.io/wp-content/plugins/table-of-contents-plus/screen.min.css?ver=2309' type='text/css' media='all' />
<style id='toc-screen-inline-css' type='text/css'>
div#toc_container {background: #f9f9f9;border: 1px solid #aaaaaa;}
</style>
<script type="text/javascript" src="https://Drunkar.github.io/wp-includes/js/jquery/ui/core.min.js?ver=1.13.3" id="jquery-ui-core-js"></script>
<script type="text/javascript" src="https://Drunkar.github.io/wp-includes/js/jquery/ui/tooltip.min.js?ver=1.13.3" id="jquery-ui-tooltip-js"></script>
<script type="text/javascript" src="https://Drunkar.github.io/wp-content/themes/tokimeki/asset/js/foundation.min.js" id="foundation-js"></script>
<script type="text/javascript" src="https://Drunkar.github.io/wp-includes/js/dist/vendor/moment.min.js?ver=2.30.1" id="moment-js"></script>
<script type="text/javascript" id="moment-js-after">
/* <![CDATA[ */
moment.updateLocale( 'ja', {"months":["1\u6708","2\u6708","3\u6708","4\u6708","5\u6708","6\u6708","7\u6708","8\u6708","9\u6708","10\u6708","11\u6708","12\u6708"],"monthsShort":["1\u6708","2\u6708","3\u6708","4\u6708","5\u6708","6\u6708","7\u6708","8\u6708","9\u6708","10\u6708","11\u6708","12\u6708"],"weekdays":["\u65e5\u66dc\u65e5","\u6708\u66dc\u65e5","\u706b\u66dc\u65e5","\u6c34\u66dc\u65e5","\u6728\u66dc\u65e5","\u91d1\u66dc\u65e5","\u571f\u66dc\u65e5"],"weekdaysShort":["\u65e5","\u6708","\u706b","\u6c34","\u6728","\u91d1","\u571f"],"week":{"dow":1},"longDateFormat":{"LT":"g:i A","LTS":null,"L":null,"LL":"Y\u5e74n\u6708j\u65e5","LLL":"Y\u5e74n\u6708j\u65e5 g:i A","LLLL":null}} );
/* ]]> */
</script>
<script type="text/javascript" id="tokimeki-script-js-extra">
/* <![CDATA[ */
var wplocale = {"momentlocale":"en"};
/* ]]> */
</script>
<script type="text/javascript" src="https://Drunkar.github.io/wp-content/themes/tokimeki/asset/js/script.js" id="tokimeki-script-js"></script>
<script type="text/javascript" id="wpfront-scroll-top-js-extra">
/* <![CDATA[ */
var wpfront_scroll_top_data = {"data":{"css":"#wpfront-scroll-top-container{display:none;position:fixed;cursor:pointer;z-index:9999;opacity:0}#wpfront-scroll-top-container div.text-holder{padding:3px 10px;border-radius:3px;-webkit-border-radius:3px;-webkit-box-shadow:4px 4px 5px 0 rgba(50,50,50,.5);-moz-box-shadow:4px 4px 5px 0 rgba(50,50,50,.5);box-shadow:4px 4px 5px 0 rgba(50,50,50,.5)}#wpfront-scroll-top-container a{outline-style:none;box-shadow:none;text-decoration:none}            @media screen and (max-device-width: 640px) {\n                #wpfront-scroll-top-container {\n                    visibility: hidden;\n                }\n            }\n            #wpfront-scroll-top-container {right: 20px;bottom: 20px;}        #wpfront-scroll-top-container img {\n            width: auto;\n            height: auto;\n        }\n        ","html":"<div id=\"wpfront-scroll-top-container\"><img src=\"https:\/\/Drunkar.github.io\/wp-content\/plugins\/wpfront-scroll-top\/images\/icons\/36.png\" alt=\"\" title=\"\" \/><\/div>","data":{"hide_iframe":false,"button_fade_duration":200,"auto_hide":true,"auto_hide_after":2,"scroll_offset":100,"button_opacity":0.7,"button_action":"top","button_action_element_selector":"","button_action_container_selector":"html, body","button_action_element_offset":0,"scroll_duration":400}}};
/* ]]> */
</script>
<script src="https://Drunkar.github.io/wp-content/plugins/wpfront-scroll-top/js/wpfront-scroll-top.min.js?ver=2.2.10081" id="wpfront-scroll-top-js" async="async" defer="defer"></script>
<script type="text/javascript" id="toc-front-js-extra">
/* <![CDATA[ */
var tocplus = {"smooth_scroll":"1"};
/* ]]> */
</script>
<script type="text/javascript" src="https://Drunkar.github.io/wp-content/plugins/table-of-contents-plus/front.min.js?ver=2309" id="toc-front-js"></script>
<script defer type="text/javascript" src="https://Drunkar.github.io/wp-content/plugins/akismet/_inc/akismet-frontend.js?ver=1711284545" id="akismet-frontend-js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <script>
          jQuery(function($) {
              var sidebar_container = $('footer.post__sidebar.sticky-container');
              var toc_content = $('#toc_container')[0];
              if (toc_content) {
                var total_height = 0;
                sidebar_container.children().each(function(){
                    total_height = total_height + $(this).outerHeight(true);
                });
                var toc_container = $('<div id="toc-sidebar" class="sticky-content sticky is-anchored"></div>');
                toc_container.css({
                  top: total_height + "px",
                  background: "#f2f2f2",
                  marginTop: "3em",
                  marginRight: "1em",
                  width: sidebar_container.outerWidth(true)-20 + "px",
                  padding: "5px",
                  borderRadius: "8px",
                  webkitBorderRadius: "8px",
                  mozBorderRadius: "8px",
                  fontSize: "0.9em",
                  })
                $('#toc_container ul.toc_list').clone().appendTo(toc_container);
                sidebar_container.append(toc_container);
              }

              var toc_sidebar = $('#toc-sidebar'); 
              $(window).scroll(function () {
                  if ($(this).scrollTop() > 880) {
                    if (toc_sidebar[0])
                      toc_sidebar.css({position: "fixed"});
                  } else {
                    if (toc_sidebar[0])
                      toc_sidebar.css({position: "absolute"});
                  }
              });
          });
        </script>
</body>
</html>
